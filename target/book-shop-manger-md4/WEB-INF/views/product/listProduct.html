<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
<!--        <link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
        <link rel="stylesheet" href="/assets/font-awesome/css/all.css">

    <th:block th:replace="/layout/head :: head" />
</head>
<body>

<div class="wrapper">

    <!--header-->
    <div class="header">

    <th:block th:replace="/layout/header :: header" />

    </div>
    <!--end header-->

    <!--sidebar-->
        <th:block th:replace="/layout/sidebar :: sidebar" />
    <!--end sidebar-->

    <!--main content-->
        <main id="main" class="main">

            <div class="pagetitle">

                    <button  id="addProduct" class="btn btn-outline-primary btn-add create-modal"
                            style="margin-left: 15px">
                        <i class="fa fa-plus"></i> Add new Product
                    </button>

            </div>

            <!-- End Page Title -->

            <section class="section dashboard">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-box">
                            <div class="responsive-table-plugin">
                                <div class="table-rep-plugin">
                                    <div class="table-responsive" data-pattern="priority-columns">
                                        <table id="tbListProducts" class="table  table-hover tbCustomer">
                                            <thead>
                                            <tr style="background-color: #9ce9">
                                                <th class="text-center ">Id</th>
                                                <th class="text-center " >Product Name</th>
                                                <th class="text-center ">Image</th>
                                                <th class="text-center ">Amount</th>
                                                <th class="text-center ">Prince</th>
<!--                                                <th class="text-center ">Datecreate</th>-->
<!--                                                <th class="text-center ">DateUpdate</th>-->
                                                <th class="text-center ">Category</th>
                                                <th class="text-center " colspan="2">Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    <!-- end content -->
<!-- End #main -->
<!--end main content-->
</div>
<!--footer-->
<th:block th:replace="/layout/footer :: #footer" />
<!--end footer-->
<!--script-->
<th:block th:replace="/layout/script :: script" />

<!--<script type="text/javascript" src="/assets/js/jquery-3.6.0.min.js"></script>-->


<!--end script-->
<th:block th:replace="/product/modal_create :: modal_create" />

<th:block th:replace="/product/modal_update :: modal_update" />


<script>



    let category = new Category();
    let product = new Product();

    function loadAllProduct(){
        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": "http://localhost:8080/api/products"

        })
        .done((data)=>{

            $.each(data, (i,item) =>{
                product = item;

           let str = `
            <tr>
              <td class="text-center ">${product.id}</td>
              <td class="text-center ">${product.productName}</td>
              <td class="text-center "><img width="60px" style="border-radius: 10px;" src="${product.image}"></td>
              <td class="text-center ">${product.amountProduct}</td>
              <td class="text-center ">${product.priceProduct}</td>
              <td class="text-center ">${product.category.name}</td>
               <td class=" text-center "><button data-id="${product.id}" class="btn btn-success btn_edit"  id="btn_edit"><i class="fa-solid fa-pen-to-square"></i></button></td>
               <td class=" text-center "><button data-id="${product.id}" class="btn btn-danger btn-delete"  id="btn-delete"><i class="fas fa-trash-alt"></i></button></td>
            </tr>

           ` ;

                $("#tbListProducts tbody").append(str)

                handleShowCreatProduct();
                handleShowUpdateProduct();
                // showCategory();
                })
        }).fail(() => {
            App.SweetAlert.showErrorAlert("Product Errors")
            })
    }
    function getProductById(productId) {
        return $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            "type": "GET",
            url: "http://localhost:8080/api/products/" + productId
        }).done((data) => {
            product = data;
            console.log(product);
        }).fail((jqXHR) => {
            App.SweetAlert.showErrorAlert("fail id product");
            console.log(jqXHR);
        })
    }


      function handleShowCreatProduct(){
          $('.create-modal').on('click', () => {
              $('#modalCreateProduct').modal('show');
          })
      }
      function handleShowUpdateProduct(){
        $('.btn_edit').on('click', () =>{
            $('#modalUpdateProduct').modal('show')
        })
      }


      $("#btnCreateProduct").on("click", () =>{
          category.id = $("#categoryCrea").val();
          category.name = $("#categoryCrea  :selected").text();

          // category.code = " b "
          delete product.id;
          product.productName = $("#nameCre").val();
          product.image = $("#imageCrea").val();
          product.amountProduct = $("#amountCrea").val();
          product.priceProduct = $("#priceCrea").val();
          product.category = category;
          console.log(category)


          $.ajax({
             headers:{
                 accept: "application/json",
                 "content-type" : "application/json"
             },
              type : "POST",
              url:"http://localhost:8080/api/products/create",
              data: JSON.stringify(product)

          })
          .done((data) =>{
              product = data;
              category = product.category;
              $('#modalCreateProduct').modal('hide');

              let str = `
            <tr>
              <td class="text-center align-middle">${product.id}</td>
              <td class="text-center align-middle">${product.productName}</td>
              <td class="text-center align-middle"><img width="60px" style="border-radius: 10px;" src="${product.image}"></td>
              <td class="text-center align-middle">${product.amountProduct}</td>
              <td class="text-center align-middle">${product.priceProduct}</td>
              <td class="text-center align-middle">${product.category.name}</td>
               <td class="align-middle text-center "><button data-id="${product.id}" class="btn btn-success btn_edit"  id="btn_edit"><i class="fa-solid fa-pen-to-square"></i></button></td>
               <td class="align-middle text-center "><button data-id="${product.id}" class="btn btn-danger btn-delete"  id="btn-delete"><i class="fas fa-trash-alt"></i></button></td>
            </tr>

           ` ;

              $("#tbListProducts tbody").append(str)

              App.IziToast.showSuccessAlert("Thêm sản phẩm thành công")

              handleShowCreatProduct();
          })
           .fail(() =>{
               // $('#modalCreateProduct .alert-danger ').html('').removeClass('hide').addClass('show');
               // if (jqXHR.responseJSON.message) {
               //     let msg = jqXHR.responseJSON.message;
               //     let str = `<label for="message" id="message-error" class="error">${msg}</label>`
               //     $('#modalCreateProduct .alert-danger').append(str)
               // } else if (jqXHR.responseJSON) {
               //     let str = '';
               //     $.each(jqXHR.responseJSON, (key, item) => {
               //         str += `<label for="${key}" id="${key}-error" class="error">${item}</label><br>`;
               //         $('#modalCreateProduct .alert-danger').append(str);
               //     })
               // }
               App.IziToast.showErrorAlert("thêm sản phẩm thất bại")
           })

      })
    // function showCategory(id) {
    //
    //     $.ajax({
    //         type: "GET",
    //         url: "http://localhost:8080/api/products/category" +id
    //     }).done((data) => {
    //         console.log(data);
    //
    //         $.each(data, (i, item) => {
    //             let str = `<option value="${item.id}" >${item.name}</option>`;
    //             $("#categoryCrea").prepend(str);
    //
    //         })
    //     })


    // }

    // function handleShowDelete


    loadAllProduct();


</script>
</body>
</html>